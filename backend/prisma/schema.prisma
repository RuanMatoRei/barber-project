generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
  BARBER
}

enum AppointmentStatus {
  SCHEDULED
  CANCELED
  DONE
}

enum TimeOffType {
  BREAK // almoço, café
  PERSONAL // problema pessoal
  DAY_OFF // dia inteiro
  OTHER
}

model User {
  id       String   @id @default(uuid())
  name     String
  email    String   @unique
  phone    String
  password String
  role     UserRole @default(USER)

  appointments Appointment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Barber {
  id     String  @id @default(uuid())
  name   String
  active Boolean @default(true)

  workingHours       WorkingHour[]
  timeOffs           BarberTimeOff[]
  appointments       Appointment[]
  specialWorkingDays SpecialWorkingDay[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Service {
  id       String @id @default(uuid())
  name     String
  price    Float
  duration Int // minutos

  appointments Appointment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WorkingHour {
  id        String @id @default(uuid())
  dayOfWeek Int // 0 = domingo | 6 = sábado
  startTime String // "09:00"
  endTime   String // "18:00"

  barberId String
  barber   Barber @relation(fields: [barberId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([barberId, dayOfWeek, startTime, endTime])
}

model BarberTimeOff {
  id            String      @id @default(uuid())
  type          TimeOffType
  startDateTime DateTime
  endDateTime   DateTime
  reason        String?

  barberId String
  barber   Barber @relation(fields: [barberId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([barberId, startDateTime, endDateTime])
}

model Appointment {
  id       String            @id @default(uuid())
  dateTime DateTime
  status   AppointmentStatus @default(SCHEDULED)

  userId    String
  barberId  String
  serviceId String

  user    User    @relation(fields: [userId], references: [id])
  barber  Barber  @relation(fields: [barberId], references: [id])
  service Service @relation(fields: [serviceId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([barberId, dateTime])
}

model SpecialWorkingDay {
  id        String   @id @default(uuid())
  date      DateTime // apenas a data (2026-01-27)
  startTime String // "09:00"
  endTime   String // "22:00"

  barberId String
  barber   Barber @relation(fields: [barberId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([barberId, date])
}
